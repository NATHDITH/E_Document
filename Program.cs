//using E_Document.Models;

//using Microsoft.AspNetCore.Authentication.Cookies;
//using Microsoft.EntityFrameworkCore;

//var builder = WebApplication.CreateBuilder(args);

//// ??????????????? DbContext
//builder.Services.AddDbContext<AutoPdfContext>(options =>
//    options.UseSqlServer(builder.Configuration.GetConnectionString("AutoPDFDb"))); // ????????????????????????????

//// ??????????????????? Cookie Authentication
//builder.Services.AddAuthentication(CookieAuthenticationDefaults.AuthenticationScheme)
//    .AddCookie(options =>
//    {
//        options.LoginPath = "/Home/Login";  // ? ??????????? Login
//        options.LogoutPath = "/Home/Logout";
//        options.AccessDeniedPath = "/Home/AccessDenied";
//        options.ExpireTimeSpan = TimeSpan.FromMinutes(30); // ? ???????????????
//        options.SlidingExpiration = true; // ? ?????????????????????????????????????
//    });

//builder.Services.AddAuthorization();
//builder.Services.AddControllersWithViews();

//var app = builder.Build();
//app.UseStaticFiles(); // ? ??????????? wwwroot ???
//// ???????? middleware ?????????????????
//app.UseRouting(); // ??????????? UseAuthorization
//app.UseAuthentication(); // ? ??????????? Authorization
//app.UseAuthorization();  // ? ?????????????? UseAuthentication


//app.UseRouting();
//app.MapControllerRoute(
//    name: "default",
//    pattern: "{controller=Home}/{action=Login}/{id?}");

//app.Run();

using E_Document.Models;

using Microsoft.AspNetCore.Authentication.Cookies;
using Microsoft.EntityFrameworkCore;
using System.Globalization;
using Microsoft.AspNetCore.Localization;

var builder = WebApplication.CreateBuilder(args);

// ????????? DbContext
builder.Services.AddDbContext<AutoPdfContext>(options =>
    options.UseSqlServer(builder.Configuration.GetConnectionString("AutoPDFDb")));

// ??????? Cookie Authentication
builder.Services.AddAuthentication(CookieAuthenticationDefaults.AuthenticationScheme)
    .AddCookie(options =>
    {
        options.LoginPath = "/Home/Login";  // ???? Login
        options.LogoutPath = "/Home/Logout";
        options.AccessDeniedPath = "/Home/AccessDenied";
        options.ExpireTimeSpan = TimeSpan.FromMinutes(30); // ??????????????????
        options.SlidingExpiration = true; // ????????????????????????????????????
    });

builder.Services.AddAuthorization();
builder.Services.AddControllersWithViews();

var app = builder.Build();

app.UseStaticFiles(); // ??? wwwroot

// ? ???????????????? Culture ????????????????????? ???? 1482
var cultureInfo = new CultureInfo("en-US");
CultureInfo.DefaultThreadCurrentCulture = cultureInfo;
CultureInfo.DefaultThreadCurrentUICulture = cultureInfo;

app.UseRequestLocalization(new RequestLocalizationOptions
{
    DefaultRequestCulture = new RequestCulture(cultureInfo),
    SupportedCultures = new List<CultureInfo> { cultureInfo },
    SupportedUICultures = new List<CultureInfo> { cultureInfo }
});

// ????? middleware ??????????????????
app.UseRouting();
app.UseAuthentication();
app.UseAuthorization();

app.MapControllerRoute(
    name: "default",
    pattern: "{controller=Home}/{action=Login}/{id?}");

app.Run();

